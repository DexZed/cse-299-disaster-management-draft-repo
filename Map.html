<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangladesh Emergency Map - Real-Time Disaster Response</title>

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            background: #f5f5f5;
            padding-top: 60px;
        }

        /* Navigation Bar */
        .top-nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            z-index: 2000;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
        }

        .nav-brand {
            font-size: 1.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-links {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .nav-link {
            padding: 8px 16px;
            background: white;
            color: #667eea;
            border: 2px solid rgba(102, 126, 234, 0.2);
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .nav-link:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .map-container {
            display: flex;
            height: calc(100vh - 60px);
            overflow: hidden;
        }

        /* Sidebar */
        .sidebar {
            width: 350px;
            background: white;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            z-index: 1000;
        }

        .sidebar-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
        }

        .sidebar-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .sidebar-content {
            padding: 20px;
            flex: 1;
        }

        /* Search Box */
        .search-container {
            margin-bottom: 20px;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 40px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-input.active {
            border-color: #28a745;
            background: #f0fff4;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 1.2rem;
        }

        .clear-search {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: #999;
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0;
            display: none;
        }

        .clear-search:hover {
            color: #dc3545;
        }

        .clear-search.visible {
            display: block;
        }

        .search-results {
            margin-top: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        .no-results {
            text-align: center;
            padding: 20px;
            color: #999;
            font-style: italic;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h2 {
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Legend */
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .legend-item:last-child {
            border-bottom: none;
        }

        .legend-marker {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        .legend-marker.critical {
            background: #dc3545;
            color: white;
        }

        .legend-marker.high {
            background: #ff8042;
            color: white;
        }

        .legend-marker.medium {
            background: #ffc107;
            color: #333;
        }

        .legend-marker.low {
            background: #28a745;
            color: white;
        }

        .legend-marker.resource {
            background: #0088FE;
            color: white;
        }

        .legend-text {
            flex: 1;
        }

        .legend-count {
            background: #f0f0f0;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            color: #666;
        }

        /* Areas List */
        .area-item {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }

        .area-item:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }

        .area-item.critical {
            border-left-color: #dc3545;
        }

        .area-item.high {
            border-left-color: #ff8042;
        }

        .area-item.medium {
            border-left-color: #ffc107;
        }

        .area-item.low {
            border-left-color: #28a745;
        }

        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .area-name {
            font-weight: 600;
            color: #333;
        }

        .area-badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .area-badge.critical {
            background: #dc3545;
            color: white;
        }

        .area-badge.high {
            background: #ff8042;
            color: white;
        }

        .area-badge.medium {
            background: #ffc107;
            color: #333;
        }

        .area-badge.low {
            background: #28a745;
            color: white;
        }

        .area-details {
            font-size: 0.85rem;
            color: #666;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        /* Map */
        #map {
            flex: 1;
            height: 100vh;
        }

        /* Controls */
        .map-controls {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .control-btn {
            background: white;
            border: 2px solid #ddd;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .control-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .control-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .control-btn.view-btn {
            font-size: 0.9rem;
            padding: 8px 12px;
        }

        .control-btn.view-btn.active {
            background: #0088FE;
            border-color: #0088FE;
            box-shadow: 0 4px 8px rgba(0, 136, 254, 0.3);
        }

        /* Location Search Marker Animation */
        @keyframes locationBounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .location-search-marker {
            animation: locationBounce 0.6s ease-in-out 3;
        }

        /* Real-time Indicator */
        .realtime-indicator {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
                transform: scale(1);
            }

            50% {
                opacity: 0.5;
                transform: scale(1.2);
            }
        }

        .status-dot.updating {
            background: #ffc107;
        }

        .realtime-text {
            color: #666;
        }

        .last-update {
            margin-left: auto;
            color: #999;
            font-size: 0.85rem;
        }

        /* Notification Badge */
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: bold;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* Update Animation */
        @keyframes flashUpdate {
            0% {
                background: #fff3cd;
            }

            100% {
                background: #f8f9fa;
            }
        }

        .area-item.updated {
            animation: flashUpdate 1s ease;
        }

        /* Stats Bar */
        .stats-bar {
            background: white;
            padding: 15px 20px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-around;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
            transition: all 0.3s;
        }

        .stat-value.updated {
            color: #28a745;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #666;
        }

        /* Custom Popup */
        .custom-popup h3 {
            margin: 0 0 10px 0;
            color: #333;
        }

        .custom-popup p {
            margin: 5px 0;
            font-size: 0.9rem;
            color: #666;
        }

        .custom-popup strong {
            color: #333;
        }

        /* Highlighted Marker Animation */
        @keyframes markerPulse {
            0% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }

            50% {
                box-shadow: 0 0 0 15px rgba(102, 126, 234, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0);
            }
        }

        .marker-highlight {
            animation: markerPulse 2s ease-out infinite;
        }

        /* Search Match Highlight */
        .area-item.search-match {
            background: #e3f2fd;
            border-left-width: 6px;
        }

        /* Toggle Sidebar Button */
        .toggle-sidebar {
            position: absolute;
            top: 20px;
            left: 360px;
            z-index: 1001;
            background: white;
            border: 2px solid #ddd;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .toggle-sidebar:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .sidebar.collapsed {
            transform: translateX(-350px);
        }

        .sidebar.collapsed~.toggle-sidebar {
            left: 10px;
        }

        /* Notification Animations */
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }

            to {
                transform: translateX(400px);
                opacity: 0;
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: absolute;
                height: 100%;
                z-index: 2000;
                transform: translateX(-350px);
                transition: transform 0.3s;
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .toggle-sidebar {
                left: 10px;
            }

            .sidebar.open~.toggle-sidebar {
                left: 360px;
            }
        }
    </style>
</head>

<body>
    <!-- Navigation Bar -->
    <nav class="top-nav">
        <div class="nav-brand">
            <span>üö®</span>
            Emergency Response System
        </div>
        <div class="nav-links">
            <a href="Map.html" class="nav-link active">
                <span>üó∫Ô∏è</span>
                Public Map
            </a>
            <a href="../admin-dashboard.html" class="nav-link">
                <span>üë®‚Äçüíº</span>
                Admin Dashboard
            </a>
            <a href="../Chatbox.html" class="nav-link">
                <span>üí¨</span>
                Public Chat
            </a>
        </div>
    </nav>

    <div class="map-container">
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>üáßüá© Bangladesh Emergency Map</h1>
                <p>Real-Time Disaster Response & Resource Management</p>
            </div>

            <div class="sidebar-content">
                <!-- Real-time Status Indicator -->
                <div class="realtime-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <div class="realtime-text">
                        <strong>Live Updates</strong>
                        <span id="statusText">Active</span>
                    </div>
                    <div class="last-update" id="lastUpdate">Just now</div>
                </div>

                <!-- Search Section -->
                <div class="search-container">
                    <div class="search-box">
                        <span class="search-icon">üîç</span>
                        <input type="text" class="search-input" id="searchInput"
                            placeholder="Search areas, resources, or locations...">
                        <button class="clear-search" id="clearSearch">‚úï</button>
                    </div>
                    <div class="search-results" id="searchResults"></div>
                </div>

                <!-- Legend Section -->
                <div class="section">
                    <h2>üìç Map Legend</h2>
                    <div class="legend-item">
                        <div class="legend-marker critical">‚ö†Ô∏è</div>
                        <div class="legend-text">Critical Area</div>
                        <div class="legend-count" id="criticalCount">0</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker high">‚ö°</div>
                        <div class="legend-text">High Priority</div>
                        <div class="legend-count" id="highCount">0</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker medium">‚ö†Ô∏è</div>
                        <div class="legend-text">Medium Priority</div>
                        <div class="legend-count" id="mediumCount">0</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker low">‚úì</div>
                        <div class="legend-text">Low Priority</div>
                        <div class="legend-count" id="lowCount">0</div>
                    </div>
                    <div class="legend-item">
                        <div class="legend-marker resource">üì¶</div>
                        <div class="legend-text">Resource Center</div>
                        <div class="legend-count" id="resourceCount">0</div>
                    </div>
                </div>

                <!-- Affected Areas List -->
                <div class="section">
                    <h2>üìã Affected Areas List</h2>
                    <div id="areasList">
                        <!-- Areas will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="totalAreas">0</div>
                    <div class="stat-label">Total Areas</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="criticalAreas">0</div>
                    <div class="stat-label">Critical</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="activeResources">0</div>
                    <div class="stat-label">Resources</div>
                </div>
            </div>
        </div>

        <!-- Toggle Sidebar Button -->
        <button class="toggle-sidebar" id="toggleSidebar">
            ‚ò∞
        </button>

        <!-- Map -->
        <div id="map"></div>

        <!-- Map Controls -->
        <div class="map-controls">
            <button class="control-btn" id="showAllBtn">Show All</button>
            <button class="control-btn" id="showCriticalBtn">Critical Only</button>
            <button class="control-btn" id="showResourcesBtn">Resources</button>
            <button class="control-btn" id="toggleUpdatesBtn"
                style="background: #28a745; color: white; border-color: #28a745;">
                ‚è∏Ô∏è Pause Updates
            </button>

            <!-- Map View Type Controls -->
            <div style="margin-top: 15px; padding-top: 15px; border-top: 2px solid #e0e0e0;">
                <div style="font-size: 0.85rem; font-weight: 600; color: #666; margin-bottom: 8px;">üó∫Ô∏è Map View</div>
                <button class="control-btn view-btn active" id="standardViewBtn" onclick="switchMapView('standard')">üìç
                    Standard</button>
                <button class="control-btn view-btn" id="satelliteViewBtn" onclick="switchMapView('satellite')">üõ∞Ô∏è
                    Satellite</button>
                <button class="control-btn view-btn" id="hybridViewBtn" onclick="switchMapView('hybrid')">üåç
                    Hybrid</button>
                <button class="control-btn view-btn" id="terrainViewBtn" onclick="switchMapView('terrain')">‚õ∞Ô∏è
                    Terrain</button>
            </div>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Bangladesh affected areas data
        const affectedAreas = [
            {
                id: 1,
                name: 'Dhaka - Old Town Flooding',
                priority: 'critical',
                coordinates: [23.7104, 90.4074],
                affectedPeople: 2500,
                resources: ['Medical', 'Food', 'Water'],
                description: 'Severe flooding in Old Dhaka. Immediate evacuation and medical assistance needed.',
                lastUpdated: '2025-11-13 10:30'
            },
            {
                id: 2,
                name: 'Chittagong - Coastal Storm Area',
                priority: 'critical',
                coordinates: [22.3569, 91.7832],
                affectedPeople: 3200,
                resources: ['Medical', 'Shelter', 'Food', 'Water'],
                description: 'Severe cyclone damage. Urgent medical care and shelter required.',
                lastUpdated: '2025-11-13 12:15'
            },
            {
                id: 3,
                name: 'Sylhet - River Overflow',
                priority: 'high',
                coordinates: [24.8949, 91.8687],
                affectedPeople: 1800,
                resources: ['Food', 'Water', 'Shelter'],
                description: 'River overflow causing widespread flooding. Relief camps being established.',
                lastUpdated: '2025-11-13 09:15'
            },
            {
                id: 4,
                name: 'Khulna - Cyclone Shelter',
                priority: 'high',
                coordinates: [22.8456, 89.5403],
                affectedPeople: 1500,
                resources: ['Food', 'Water', 'Medical'],
                description: 'Cyclone shelter at capacity. Additional supplies needed urgently.',
                lastUpdated: '2025-11-13 11:00'
            },
            {
                id: 5,
                name: 'Rajshahi - Relief Camp',
                priority: 'high',
                coordinates: [24.3745, 88.6042],
                affectedPeople: 950,
                resources: ['Shelter', 'Food'],
                description: 'Temporary relief camp operational. Need more medical supplies.',
                lastUpdated: '2025-11-13 10:45'
            },
            {
                id: 6,
                name: "Cox's Bazar - Evacuation Center",
                priority: 'high',
                coordinates: [21.4272, 92.0058],
                affectedPeople: 2100,
                resources: ['Medical', 'Water', 'Shelter'],
                description: 'Coastal evacuation in progress. Medical teams deployed.',
                lastUpdated: '2025-11-13 08:00'
            },
            {
                id: 7,
                name: 'Rangpur - Community Relief',
                priority: 'medium',
                coordinates: [25.7439, 89.2752],
                affectedPeople: 600,
                resources: ['Food', 'Water'],
                description: 'Community center providing relief. Situation stabilizing.',
                lastUpdated: '2025-11-13 09:30'
            },
            {
                id: 8,
                name: 'Barisal - Medical Station',
                priority: 'low',
                coordinates: [22.7010, 90.3535],
                affectedPeople: 350,
                resources: ['Medical'],
                description: 'Minor medical station operational. Treating minor injuries.',
                lastUpdated: '2025-11-13 07:45'
            },
            {
                id: 9,
                name: 'Mymensingh - Flash Flood Zone',
                priority: 'critical',
                coordinates: [24.7471, 90.4203],
                affectedPeople: 2800,
                resources: ['Food', 'Water', 'Shelter', 'Medical'],
                description: 'Sudden flash flooding affecting multiple villages. Emergency rescue operations ongoing.',
                lastUpdated: '2025-11-25 11:20'
            },
            {
                id: 10,
                name: 'Gazipur - Industrial Area Flood',
                priority: 'high',
                coordinates: [23.9999, 90.4203],
                affectedPeople: 1650,
                resources: ['Medical', 'Food', 'Water'],
                description: 'Factory areas submerged. Workers and families need immediate assistance.',
                lastUpdated: '2025-11-25 10:15'
            },
            {
                id: 11,
                name: 'Narayanganj - River Erosion',
                priority: 'high',
                coordinates: [23.6238, 90.5000],
                affectedPeople: 1420,
                resources: ['Shelter', 'Food', 'Blankets'],
                description: 'Riverbank erosion displacing families. Temporary shelters urgently needed.',
                lastUpdated: '2025-11-25 09:45'
            },
            {
                id: 12,
                name: 'Comilla - Landslide Area',
                priority: 'critical',
                coordinates: [23.4607, 91.1809],
                affectedPeople: 1980,
                resources: ['Medical', 'Shelter', 'Water', 'Food'],
                description: 'Heavy rains triggered landslides. Multiple casualties reported. Search and rescue active.',
                lastUpdated: '2025-11-25 12:00'
            },
            {
                id: 13,
                name: 'Jessore - Agricultural Flood',
                priority: 'medium',
                coordinates: [23.1697, 89.2132],
                affectedPeople: 890,
                resources: ['Food', 'Water', 'Seeds'],
                description: 'Farmlands flooded. Crops destroyed. Farmers need food supplies and agricultural support.',
                lastUpdated: '2025-11-25 08:30'
            },
            {
                id: 14,
                name: 'Bogra - Emergency Relief Station',
                priority: 'medium',
                coordinates: [24.8465, 89.3770],
                affectedPeople: 720,
                resources: ['Medical', 'Food'],
                description: 'Relief station operational. Managing moderate flood victims. Additional supplies needed.',
                lastUpdated: '2025-11-25 10:00'
            },
            {
                id: 15,
                name: 'Tangail - Displacement Camp',
                priority: 'high',
                coordinates: [24.2513, 89.9167],
                affectedPeople: 1580,
                resources: ['Shelter', 'Water', 'Food', 'Blankets'],
                description: 'Large displacement camp. Sanitation concerns. Medical team deployed.',
                lastUpdated: '2025-11-25 11:45'
            },
            {
                id: 16,
                name: 'Kushtia - Border Area Flooding',
                priority: 'medium',
                coordinates: [23.9013, 89.1205],
                affectedPeople: 980,
                resources: ['Food', 'Water', 'Medical'],
                description: 'Border areas affected by cross-border river overflow. Relief coordination underway.',
                lastUpdated: '2025-11-25 09:20'
            },
            {
                id: 17,
                name: 'Dinajpur - Cold Wave Shelter',
                priority: 'medium',
                coordinates: [25.6279, 88.6332],
                affectedPeople: 1150,
                resources: ['Blankets', 'Clothing', 'Food'],
                description: 'Cold wave affecting northern region. Warm clothing and blankets urgently needed.',
                lastUpdated: '2025-11-25 07:30'
            },
            {
                id: 18,
                name: 'Faridpur - Padma River Overflow',
                priority: 'high',
                coordinates: [23.6070, 89.8429],
                affectedPeople: 2240,
                resources: ['Medical', 'Shelter', 'Food', 'Water'],
                description: 'Padma River overflowing. Multiple villages submerged. Boat rescue operations active.',
                lastUpdated: '2025-11-25 11:10'
            },
            {
                id: 19,
                name: 'Sirajganj - Jamuna Bridge Area',
                priority: 'high',
                coordinates: [24.4533, 89.7006],
                affectedPeople: 1890,
                resources: ['Food', 'Water', 'Shelter'],
                description: 'Jamuna River flooding affecting bridge area communities. Evacuation in progress.',
                lastUpdated: '2025-11-25 10:50'
            },
            {
                id: 20,
                name: 'Pabna - Rural Flood Zone',
                priority: 'medium',
                coordinates: [24.0064, 89.2372],
                affectedPeople: 840,
                resources: ['Food', 'Water', 'Medical'],
                description: 'Rural areas experiencing moderate flooding. Agricultural damage significant.',
                lastUpdated: '2025-11-25 08:45'
            },
            {
                id: 21,
                name: 'Kishoreganj - Haor Basin Flood',
                priority: 'critical',
                coordinates: [24.4260, 90.7760],
                affectedPeople: 3150,
                resources: ['Medical', 'Food', 'Water', 'Shelter', 'Boats'],
                description: 'Haor basin severely flooded. Island communities cut off. Boat rescue essential.',
                lastUpdated: '2025-11-25 12:30'
            },
            {
                id: 22,
                name: 'Netrokona - Remote Village Emergency',
                priority: 'high',
                coordinates: [24.8804, 90.7273],
                affectedPeople: 1320,
                resources: ['Food', 'Medical', 'Water'],
                description: 'Remote villages difficult to access. Helicopter drops may be needed.',
                lastUpdated: '2025-11-25 09:50'
            },
            {
                id: 23,
                name: 'Sunamganj - Tea Garden Flooding',
                priority: 'medium',
                coordinates: [25.0658, 91.3950],
                affectedPeople: 760,
                resources: ['Shelter', 'Food', 'Water'],
                description: 'Tea garden workers affected by flooding. Temporary shelters being arranged.',
                lastUpdated: '2025-11-25 08:15'
            },
            {
                id: 24,
                name: 'Habiganj - Gas Field Area',
                priority: 'low',
                coordinates: [24.3745, 91.4156],
                affectedPeople: 420,
                resources: ['Medical', 'Food'],
                description: 'Minor flooding near gas fields. Situation under control. Monitoring continues.',
                lastUpdated: '2025-11-25 07:00'
            },
            {
                id: 25,
                name: 'Moulvibazar - Hill District Alert',
                priority: 'medium',
                coordinates: [24.4820, 91.7314],
                affectedPeople: 890,
                resources: ['Medical', 'Shelter', 'Food'],
                description: 'Hill areas at risk of landslides. Preventive evacuations underway.',
                lastUpdated: '2025-11-25 10:20'
            },
            {
                id: 26,
                name: 'Satkhira - Coastal Embankment Breach',
                priority: 'critical',
                coordinates: [22.7185, 89.0705],
                affectedPeople: 2650,
                resources: ['Medical', 'Food', 'Water', 'Shelter'],
                description: 'Embankment breached. Saltwater flooding shrimp farms. Emergency repairs needed.',
                lastUpdated: '2025-11-25 11:55'
            },
            {
                id: 27,
                name: 'Patuakhali - Cyclone Preparation Center',
                priority: 'high',
                coordinates: [22.3596, 90.3298],
                affectedPeople: 1780,
                resources: ['Food', 'Water', 'Medical'],
                description: 'Cyclone warning issued. People gathering at preparation centers. Supplies needed.',
                lastUpdated: '2025-11-25 10:35'
            },
            {
                id: 28,
                name: 'Bhola - Island Evacuation',
                priority: 'high',
                coordinates: [22.6859, 90.6482],
                affectedPeople: 1940,
                resources: ['Boats', 'Food', 'Water', 'Shelter'],
                description: 'Island residents being evacuated. Boat transport critical. Weather deteriorating.',
                lastUpdated: '2025-11-25 11:25'
            },
            {
                id: 29,
                name: 'Barguna - Fishing Community Crisis',
                priority: 'medium',
                coordinates: [22.1590, 90.1119],
                affectedPeople: 680,
                resources: ['Food', 'Medical', 'Water'],
                description: 'Fishing boats damaged in storm. Community needs food and medical assistance.',
                lastUpdated: '2025-11-25 09:10'
            },
            {
                id: 30,
                name: 'Lakshmipur - Meghna River Flooding',
                priority: 'high',
                coordinates: [22.9447, 90.8282],
                affectedPeople: 1560,
                resources: ['Shelter', 'Food', 'Water'],
                description: 'Meghna River levels rising rapidly. Low-lying areas being evacuated.',
                lastUpdated: '2025-11-25 10:40'
            }
        ];

        // Bangladesh resource centers
        const resourceCenters = [
            {
                id: 'R1',
                name: 'Dhaka Central Supply Depot',
                coordinates: [23.8103, 90.4125],
                resources: ['Medical', 'Food', 'Water', 'Shelter'],
                quantity: 5000
            },
            {
                id: 'R2',
                name: 'Chittagong Emergency Warehouse',
                coordinates: [22.3475, 91.8123],
                resources: ['Equipment', 'Personnel', 'Medical'],
                quantity: 3500
            },
            {
                id: 'R3',
                name: 'Sylhet Medical Supply Center',
                coordinates: [24.9036, 91.8611],
                resources: ['Medical', 'Water'],
                quantity: 2000
            },
            {
                id: 'R4',
                name: 'Mymensingh Regional Warehouse',
                coordinates: [24.7636, 90.4203],
                resources: ['Food', 'Water', 'Shelter', 'Blankets'],
                quantity: 2800
            },
            {
                id: 'R5',
                name: 'Khulna Coastal Emergency Center',
                coordinates: [22.8156, 89.5680],
                resources: ['Medical', 'Boats', 'Food', 'Water'],
                quantity: 3200
            },
            {
                id: 'R6',
                name: 'Rajshahi Northern Supply Hub',
                coordinates: [24.3636, 88.6241],
                resources: ['Food', 'Medical', 'Clothing', 'Blankets'],
                quantity: 2400
            },
            {
                id: 'R7',
                name: 'Comilla Equipment Depot',
                coordinates: [23.4682, 91.1869],
                resources: ['Medical', 'Shelter', 'Equipment'],
                quantity: 1800
            },
            {
                id: 'R8',
                name: 'Barisal Coastal Relief Center',
                coordinates: [22.7156, 90.3692],
                resources: ['Food', 'Water', 'Boats', 'Medical'],
                quantity: 2600
            },
            {
                id: 'R9',
                name: 'Rangpur Cold Storage Facility',
                coordinates: [25.7521, 89.2616],
                resources: ['Food', 'Blankets', 'Clothing', 'Medical'],
                quantity: 2200
            },
            {
                id: 'R10',
                name: 'Gazipur Industrial Supply',
                coordinates: [24.0022, 90.4264],
                resources: ['Medical', 'Food', 'Water'],
                quantity: 1500
            }
        ];

        // Comprehensive Bangladesh Locations Database
        const bangladeshLocations = {
            divisions: [
                { name: 'Dhaka', coordinates: [23.8103, 90.4125], type: 'division' },
                { name: 'Chittagong', coordinates: [22.3569, 91.7832], type: 'division' },
                { name: 'Rajshahi', coordinates: [24.3745, 88.6042], type: 'division' },
                { name: 'Khulna', coordinates: [22.8456, 89.5403], type: 'division' },
                { name: 'Sylhet', coordinates: [24.8949, 91.8687], type: 'division' },
                { name: 'Barisal', coordinates: [22.7010, 90.3535], type: 'division' },
                { name: 'Rangpur', coordinates: [25.7439, 89.2752], type: 'division' },
                { name: 'Mymensingh', coordinates: [24.7471, 90.4203], type: 'division' }
            ],
            majorCities: [
                { name: 'Dhaka City', coordinates: [23.8103, 90.4125], type: 'city' },
                { name: 'Chittagong City', coordinates: [22.3569, 91.7832], type: 'city' },
                { name: 'Sylhet City', coordinates: [24.8949, 91.8687], type: 'city' },
                { name: 'Rajshahi City', coordinates: [24.3745, 88.6042], type: 'city' },
                { name: 'Khulna City', coordinates: [22.8456, 89.5403], type: 'city' },
                { name: 'Barisal City', coordinates: [22.7010, 90.3535], type: 'city' },
                { name: 'Rangpur City', coordinates: [25.7439, 89.2752], type: 'city' },
                { name: 'Comilla', coordinates: [23.4607, 91.1809], type: 'city' },
                { name: 'Gazipur', coordinates: [23.9999, 90.4203], type: 'city' },
                { name: 'Narayanganj', coordinates: [23.6238, 90.5000], type: 'city' },
                { name: 'Cox\'s Bazar', coordinates: [21.4272, 92.0058], type: 'city' },
                { name: 'Jessore', coordinates: [23.1697, 89.2132], type: 'city' },
                { name: 'Bogra', coordinates: [24.8465, 89.3770], type: 'city' },
                { name: 'Tangail', coordinates: [24.2513, 89.9167], type: 'city' },
                { name: 'Mymensingh City', coordinates: [24.7471, 90.4203], type: 'city' },
                { name: 'Dinajpur', coordinates: [25.6279, 88.6332], type: 'city' },
                { name: 'Pabna', coordinates: [24.0064, 89.2372], type: 'city' },
                { name: 'Kushtia', coordinates: [23.9013, 89.1205], type: 'city' },
                { name: 'Faridpur', coordinates: [23.6070, 89.8429], type: 'city' },
                { name: 'Sirajganj', coordinates: [24.4533, 89.7006], type: 'city' }
            ],
            districts: [
                { name: 'Dhaka District', coordinates: [23.7104, 90.4074], type: 'district' },
                { name: 'Chittagong District', coordinates: [22.3569, 91.7832], type: 'district' },
                { name: 'Sylhet District', coordinates: [24.8949, 91.8687], type: 'district' },
                { name: 'Rajshahi District', coordinates: [24.3745, 88.6042], type: 'district' },
                { name: 'Khulna District', coordinates: [22.8456, 89.5403], type: 'district' },
                { name: 'Barisal District', coordinates: [22.7010, 90.3535], type: 'district' },
                { name: 'Rangpur District', coordinates: [25.7439, 89.2752], type: 'district' },
                { name: 'Mymensingh District', coordinates: [24.7471, 90.4203], type: 'district' },
                { name: 'Narsingdi', coordinates: [23.9322, 90.7151], type: 'district' },
                { name: 'Manikganj', coordinates: [23.8644, 90.0047], type: 'district' },
                { name: 'Munshiganj', coordinates: [23.5422, 90.5305], type: 'district' },
                { name: 'Kishoreganj', coordinates: [24.4260, 90.7760], type: 'district' },
                { name: 'Netrokona', coordinates: [24.8804, 90.7273], type: 'district' },
                { name: 'Sherpur', coordinates: [25.0204, 90.0152], type: 'district' },
                { name: 'Jamalpur', coordinates: [24.9375, 89.9403], type: 'district' }
            ],
            landmarks: [
                { name: 'Shahjalal International Airport', coordinates: [23.8433, 90.3978], type: 'landmark' },
                { name: 'Shah Poran International Airport', coordinates: [24.9633, 91.8669], type: 'landmark' },
                { name: 'Sundarbans', coordinates: [21.9497, 89.1833], type: 'landmark' },
                { name: 'Padma Bridge', coordinates: [23.4635, 90.2544], type: 'landmark' },
                { name: 'Jatiyo Sangsad Bhaban', coordinates: [23.7629, 90.3782], type: 'landmark' },
                { name: 'Hatirjheel', coordinates: [23.7522, 90.4058], type: 'landmark' },
                { name: 'Lalbagh Fort', coordinates: [23.7197, 90.3875], type: 'landmark' },
                { name: 'Ahsan Manzil', coordinates: [23.7082, 90.4059], type: 'landmark' },
                { name: 'Cox\'s Bazar Beach', coordinates: [21.4272, 92.0058], type: 'landmark' },
                { name: 'Saint Martin\'s Island', coordinates: [20.6261, 92.3234], type: 'landmark' },
                { name: 'Kuakata Beach', coordinates: [21.8166, 90.1275], type: 'landmark' },
                { name: 'Ratargul Swamp Forest', coordinates: [24.9833, 91.8667], type: 'landmark' },
                { name: 'Srimangal Tea Gardens', coordinates: [24.3068, 91.7319], type: 'landmark' },
                { name: 'Paharpur', coordinates: [25.0281, 88.9769], type: 'landmark' },
                { name: 'Mahasthangarh', coordinates: [24.9621, 89.3453], type: 'landmark' }
            ]
        };

        // Combine all locations for search
        const allBangladeshLocations = [
            ...bangladeshLocations.divisions,
            ...bangladeshLocations.majorCities,
            ...bangladeshLocations.districts,
            ...bangladeshLocations.landmarks
        ];

        // Initialize map centered on Bangladesh
        const map = L.map('map').setView([23.8103, 90.4125], 7);

        // Define multiple tile layers for real-time views
        const tileLayers = {
            standard: L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }),

            satellite: L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                attribution: '¬© Esri, Maxar, Earthstar Geographics',
                maxZoom: 19
            }),

            hybrid: L.layerGroup([
                L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
                    attribution: '¬© Esri',
                    maxZoom: 19
                }),
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    opacity: 0.3,
                    maxZoom: 19
                })
            ]),

            terrain: L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenTopoMap contributors',
                maxZoom: 17
            })
        };

        // Add default tile layer (standard map view)
        let currentLayer = tileLayers.standard.addTo(map);
        let currentViewType = 'standard';

        // Store markers for filtering
        const markers = {
            affected: [],
            resources: []
        };

        // Custom icon colors
        const getMarkerColor = (priority) => {
            const colors = {
                critical: '#dc3545',
                high: '#ff8042',
                medium: '#ffc107',
                low: '#28a745'
            };
            return colors[priority] || '#666';
        };

        // Create custom marker icon
        const createCustomIcon = (color, emoji) => {
            return L.divIcon({
                className: 'custom-marker',
                html: `
                    <div style="
                        background: ${color};
                        width: 32px;
                        height: 32px;
                        border-radius: 50%;
                        border: 3px solid white;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.3);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 16px;
                    ">${emoji}</div>
                `,
                iconSize: [32, 32],
                iconAnchor: [16, 16]
            });
        };

        // Add affected area markers
        affectedAreas.forEach(area => {
            const emoji = {
                critical: '‚ö†Ô∏è',
                high: '‚ö°',
                medium: '‚ö†Ô∏è',
                low: '‚úì'
            }[area.priority];

            const icon = createCustomIcon(getMarkerColor(area.priority), emoji);

            const marker = L.marker(area.coordinates, { icon })
                .addTo(map)
                .bindPopup(`
                    <div class="custom-popup">
                        <h3>${area.name}</h3>
                        <p><strong>Priority:</strong> <span style="color: ${getMarkerColor(area.priority)}; text-transform: uppercase;">${area.priority}</span></p>
                        <p><strong>Affected People:</strong> ${area.affectedPeople}</p>
                        <p><strong>Resources Needed:</strong> ${area.resources.join(', ')}</p>
                        <p><strong>Description:</strong> ${area.description}</p>
                        <p><strong>Last Updated:</strong> ${area.lastUpdated}</p>
                    </div>
                `);

            marker.areaData = area;
            markers.affected.push(marker);
        });

        // Add resource center markers
        resourceCenters.forEach(center => {
            const icon = createCustomIcon('#0088FE', 'üì¶');

            const marker = L.marker(center.coordinates, { icon })
                .addTo(map)
                .bindPopup(`
                    <div class="custom-popup">
                        <h3>${center.name}</h3>
                        <p><strong>Available Resources:</strong> ${center.resources.join(', ')}</p>
                        <p><strong>Total Quantity:</strong> ${center.quantity} units</p>
                    </div>
                `);

            marker.centerData = center;
            markers.resources.push(marker);
        });

        // Update counts
        function updateCounts() {
            const counts = {
                critical: 0,
                high: 0,
                medium: 0,
                low: 0,
                resource: resourceCenters.length
            };

            affectedAreas.forEach(area => {
                counts[area.priority]++;
            });

            document.getElementById('criticalCount').textContent = counts.critical;
            document.getElementById('highCount').textContent = counts.high;
            document.getElementById('mediumCount').textContent = counts.medium;
            document.getElementById('lowCount').textContent = counts.low;
            document.getElementById('resourceCount').textContent = counts.resource;

            document.getElementById('totalAreas').textContent = affectedAreas.length;
            document.getElementById('criticalAreas').textContent = counts.critical;
            document.getElementById('activeResources').textContent = counts.resource;
        }

        // Search functionality
        let searchResults = [];
        let locationSearchMarker = null;
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearch');
        const searchResultsDiv = document.getElementById('searchResults');

        console.log('üîç Search elements:', {
            searchInput: !!searchInput,
            clearSearchBtn: !!clearSearchBtn,
            searchResultsDiv: !!searchResultsDiv
        });

        // Search Bangladesh locations
        function searchBangladeshLocation(query) {
            const searchTerm = query.toLowerCase().trim();

            return allBangladeshLocations.filter(location => {
                return location.name.toLowerCase().includes(searchTerm) ||
                    location.type.toLowerCase().includes(searchTerm);
            }).slice(0, 10); // Limit to 10 results
        }

        // Show location on map
        function showLocationOnMap(location) {
            // Remove previous location marker if exists
            if (locationSearchMarker) {
                map.removeLayer(locationSearchMarker);
            }

            // Create custom icon for searched location
            const locationIcon = L.divIcon({
                className: 'location-search-marker',
                html: `
                    <div style="
                        background: #0088FE;
                        width: 36px;
                        height: 36px;
                        border-radius: 50%;
                        border: 4px solid white;
                        box-shadow: 0 4px 12px rgba(0, 136, 254, 0.5);
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        font-size: 18px;
                        animation: bounce 1s ease-in-out 3;
                    ">üìç</div>
                `,
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });

            // Add marker
            locationSearchMarker = L.marker(location.coordinates, { icon: locationIcon })
                .addTo(map)
                .bindPopup(`
                    <div class="custom-popup">
                        <h3>üìç ${location.name}</h3>
                        <p><strong>Type:</strong> ${location.type.charAt(0).toUpperCase() + location.type.slice(1)}</p>
                        <p><strong>Coordinates:</strong> ${location.coordinates[0].toFixed(4)}, ${location.coordinates[1].toFixed(4)}</p>
                    </div>
                `)
                .openPopup();

            // Zoom to location
            map.setView(location.coordinates, 12);

            console.log(`üìç Showing location: ${location.name} at [${location.coordinates}]`);
        }

        function performSearch(query) {
            if (!query || query.trim() === '') {
                searchResults = [];
                populateAreasList();
                searchResultsDiv.textContent = '';
                clearSearchBtn.classList.remove('visible');
                searchInput.classList.remove('active');
                // Show all markers when clearing search
                markers.affected.forEach(marker => {
                    if (!map.hasLayer(marker)) {
                        map.addLayer(marker);
                    }
                });
                markers.resources.forEach(marker => {
                    if (!map.hasLayer(marker)) {
                        map.addLayer(marker);
                    }
                });
                return;
            }

            clearSearchBtn.classList.add('visible');
            searchInput.classList.add('active');
            const searchTerm = query.toLowerCase().trim();

            console.log('üîç Searching for:', searchTerm);
            console.log('üìä Total areas to search:', affectedAreas.length);
            console.log('üì¶ Total resources to search:', resourceCenters.length);

            // Search in Bangladesh locations first
            const locationMatches = searchBangladeshLocation(searchTerm);

            // Search in affected areas
            const areaMatches = affectedAreas.filter(area => {
                return area.name.toLowerCase().includes(searchTerm) ||
                    area.description.toLowerCase().includes(searchTerm) ||
                    area.priority.toLowerCase().includes(searchTerm) ||
                    area.resources.some(r => r.toLowerCase().includes(searchTerm)) ||
                    area.affectedPeople.toString().includes(searchTerm);
            });

            // Search in resource centers
            const resourceMatches = resourceCenters.filter(center => {
                return center.name.toLowerCase().includes(searchTerm) ||
                    center.resources.some(r => r.toLowerCase().includes(searchTerm));
            });

            searchResults = {
                locations: locationMatches,
                areas: areaMatches,
                resources: resourceMatches,
                total: locationMatches.length + areaMatches.length + resourceMatches.length
            };

            console.log('‚úÖ Found:', locationMatches.length, 'locations,', areaMatches.length, 'areas,', resourceMatches.length, 'resources');

            // Update search results text with location search
            if (searchResults.total === 0) {
                searchResultsDiv.innerHTML = '<span style="color: #dc3545;">‚ùå No results found</span>';
            } else {
                let resultsText = `<span style="color: #28a745;">‚úÖ Found <strong>${searchResults.total}</strong> result${searchResults.total > 1 ? 's' : ''}</span>`;

                if (locationMatches.length > 0) {
                    resultsText += ` - <span style="color: #0088FE; font-weight: bold;">${locationMatches.length} location${locationMatches.length > 1 ? 's' : ''}</span>`;

                    // Show location results as clickable items
                    let locationList = '<div style="margin-top: 10px; max-height: 200px; overflow-y: auto;">';
                    locationMatches.forEach((loc, idx) => {
                        locationList += `
                            <div onclick="showLocationOnMap(allBangladeshLocations.find(l => l.name === '${loc.name.replace(/'/g, "\\'")}'))" 
                                 style="padding: 8px; margin: 4px 0; background: #e3f2fd; border-radius: 6px; cursor: pointer; 
                                        border-left: 3px solid #0088FE; transition: all 0.2s;"
                                 onmouseover="this.style.background='#bbdefb'; this.style.transform='translateX(3px)'"
                                 onmouseout="this.style.background='#e3f2fd'; this.style.transform='translateX(0)'">
                                <strong>üìç ${loc.name}</strong>
                                <span style="color: #666; font-size: 0.85rem; margin-left: 8px;">(${loc.type})</span>
                            </div>
                        `;
                    });
                    locationList += '</div>';
                    resultsText += locationList;
                }

                if (areaMatches.length > 0 || resourceMatches.length > 0) {
                    resultsText += `<div style="margin-top: 5px; font-size: 0.9rem; color: #666;">${areaMatches.length} affected areas, ${resourceMatches.length} resources</div>`;
                }

                searchResultsDiv.innerHTML = resultsText;
            }

            // Update areas list with filtered results
            populateAreasList(areaMatches);

            // Highlight matching markers on map
            highlightSearchResults(areaMatches, resourceMatches);
        }

        function highlightSearchResults(areaMatches, resourceMatches) {
            console.log('üó∫Ô∏è Highlighting results on map...');

            // Hide all markers first
            markers.affected.forEach(marker => map.removeLayer(marker));
            markers.resources.forEach(marker => map.removeLayer(marker));

            // Show matching area markers
            let addedAreas = 0;
            areaMatches.forEach(area => {
                const marker = markers.affected.find(m => m.areaData && m.areaData.id === area.id);
                if (marker) {
                    map.addLayer(marker);
                    addedAreas++;
                }
            });
            console.log('üìç Added', addedAreas, 'area markers to map');

            // Show matching resource markers
            let addedResources = 0;
            resourceMatches.forEach(center => {
                const marker = markers.resources.find(m => m.centerData && m.centerData.id === center.id);
                if (marker) {
                    map.addLayer(marker);
                    addedResources++;
                }
            });
            console.log('üì¶ Added', addedResources, 'resource markers to map');

            // Fit map bounds to show all results
            if (searchResults.total > 0) {
                const allCoords = [
                    ...areaMatches.map(a => a.coordinates),
                    ...resourceMatches.map(r => r.coordinates)
                ];

                if (allCoords.length === 1) {
                    // Single result - zoom in and open popup
                    map.setView(allCoords[0], 16);

                    // Open the popup for the single result
                    setTimeout(() => {
                        if (areaMatches.length === 1) {
                            const marker = markers.affected.find(m => m.areaData && m.areaData.id === areaMatches[0].id);
                            if (marker) {
                                marker.openPopup();
                                // Add pulsing effect safely
                                try {
                                    const icon = marker.getElement();
                                    if (icon) {
                                        icon.style.animation = 'markerPulse 2s ease-out 3';
                                    }
                                } catch (e) {
                                    console.log('Marker element not yet available');
                                }
                            }
                        } else if (resourceMatches.length === 1) {
                            const marker = markers.resources.find(m => m.centerData && m.centerData.id === resourceMatches[0].id);
                            if (marker) {
                                marker.openPopup();
                                // Add pulsing effect safely
                                try {
                                    const icon = marker.getElement();
                                    if (icon) {
                                        icon.style.animation = 'markerPulse 2s ease-out 3';
                                    }
                                } catch (e) {
                                    console.log('Marker element not yet available');
                                }
                            }
                        }
                    }, 500);
                } else if (allCoords.length > 1) {
                    const bounds = L.latLngBounds(allCoords);
                    map.fitBounds(bounds, { padding: [50, 50], maxZoom: 15 });

                    // Add pulsing effect to all matching markers
                    setTimeout(() => {
                        areaMatches.forEach(area => {
                            const marker = markers.affected.find(m => m.areaData && m.areaData.id === area.id);
                            if (marker) {
                                try {
                                    const icon = marker.getElement();
                                    if (icon) {
                                        icon.style.animation = 'markerPulse 2s ease-out 3';
                                    }
                                } catch (e) {
                                    console.log('Marker element not yet available');
                                }
                            }
                        });

                        resourceMatches.forEach(center => {
                            const marker = markers.resources.find(m => m.centerData && m.centerData.id === center.id);
                            if (marker) {
                                try {
                                    const icon = marker.getElement();
                                    if (icon) {
                                        icon.style.animation = 'markerPulse 2s ease-out 3';
                                    }
                                } catch (e) {
                                    console.log('Marker element not yet available');
                                }
                            }
                        });
                    }, 500);
                }
            }
        }

        function clearSearch() {
            searchInput.value = '';
            searchResults = [];
            searchResultsDiv.textContent = '';
            clearSearchBtn.classList.remove('visible');
            searchInput.classList.remove('active');
            populateAreasList();

            // Remove location search marker
            if (locationSearchMarker) {
                map.removeLayer(locationSearchMarker);
                locationSearchMarker = null;
            }

            // Show all markers (check if not already on map)
            markers.affected.forEach(marker => {
                if (!map.hasLayer(marker)) {
                    map.addLayer(marker);
                }
            });
            markers.resources.forEach(marker => {
                if (!map.hasLayer(marker)) {
                    map.addLayer(marker);
                }
            });
            map.setView([23.8103, 90.4125], 7);
        }

        // Make function global for inline onclick
        window.showLocationOnMap = showLocationOnMap;

        // Search event listeners
        console.log('üîß Setting up search event listeners...');

        if (searchInput) {
            searchInput.addEventListener('input', (e) => {
                console.log('‚å®Ô∏è Input event triggered:', e.target.value);
                performSearch(e.target.value);
            });

            searchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    console.log('‚Üµ Enter pressed');
                    performSearch(e.target.value);
                }
            });
            console.log('‚úÖ Search input listeners attached');
        } else {
            console.error('‚ùå Search input element not found!');
        }

        if (clearSearchBtn) {
            clearSearchBtn.addEventListener('click', () => {
                console.log('üóëÔ∏è Clear search clicked');
                clearSearch();
            });
            console.log('‚úÖ Clear button listener attached');
        } else {
            console.error('‚ùå Clear search button not found!');
        }

        // Populate areas list
        function populateAreasList(filteredAreas = null) {
            const areasList = document.getElementById('areasList');
            areasList.innerHTML = '';

            const areasToShow = filteredAreas || affectedAreas;
            const isSearchActive = filteredAreas !== null;

            if (areasToShow.length === 0 && filteredAreas !== null) {
                areasList.innerHTML = '<div class="no-results">No areas match your search</div>';
                return;
            }

            areasToShow.forEach(area => {
                const areaItem = document.createElement('div');
                areaItem.className = `area-item ${area.priority}`;

                // Add search-match class if this is from a search
                if (isSearchActive) {
                    areaItem.classList.add('search-match');
                }

                areaItem.innerHTML = `
                    <div class="area-header">
                        <div class="area-name">${area.name}${isSearchActive ? ' üîç' : ''}</div>
                        <div class="area-badge ${area.priority}">${area.priority}</div>
                    </div>
                    <div class="area-details">
                        <div>üë• ${area.affectedPeople} people affected</div>
                        <div>üì¶ ${area.resources.join(', ')}</div>
                    </div>
                `;

                areaItem.addEventListener('click', () => {
                    map.setView(area.coordinates, 15);
                    const marker = markers.affected.find(m => m.areaData.id === area.id);
                    if (marker) {
                        marker.openPopup();
                    }
                });

                areasList.appendChild(areaItem);
            });
        }

        // Filter controls
        document.getElementById('showAllBtn').addEventListener('click', function () {
            clearSearch(); // Clear any active search
            markers.affected.forEach(marker => map.addLayer(marker));
            markers.resources.forEach(marker => map.addLayer(marker));
            map.setView([23.8103, 90.4125], 7);

            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
        });

        document.getElementById('showCriticalBtn').addEventListener('click', function () {
            clearSearch(); // Clear any active search
            markers.affected.forEach(marker => {
                if (marker.areaData.priority === 'critical') {
                    map.addLayer(marker);
                } else {
                    map.removeLayer(marker);
                }
            });
            markers.resources.forEach(marker => map.removeLayer(marker));

            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
        });

        document.getElementById('showResourcesBtn').addEventListener('click', function () {
            clearSearch(); // Clear any active search
            markers.affected.forEach(marker => map.removeLayer(marker));
            markers.resources.forEach(marker => map.addLayer(marker));

            document.querySelectorAll('.control-btn').forEach(btn => btn.classList.remove('active'));
            this.classList.add('active');
        });

        // Toggle sidebar
        document.getElementById('toggleSidebar').addEventListener('click', function () {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');

            if (window.innerWidth <= 768) {
                sidebar.classList.toggle('open');
            }
        });

        // Real-time Updates Functionality
        let updateInterval;
        let lastUpdateTime = new Date();
        let newUpdatesCount = 0;

        // Update last update time display
        function updateTimeDisplay() {
            const now = new Date();
            const diff = Math.floor((now - lastUpdateTime) / 1000); // seconds

            let timeText;
            if (diff < 60) {
                timeText = diff === 0 ? 'Just now' : `${diff}s ago`;
            } else if (diff < 3600) {
                timeText = `${Math.floor(diff / 60)}m ago`;
            } else {
                timeText = `${Math.floor(diff / 3600)}h ago`;
            }

            document.getElementById('lastUpdate').textContent = timeText;
        }

        // Simulate real-time data updates
        function simulateRealTimeUpdate() {
            const statusDot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');

            // Show updating status
            statusDot.classList.add('updating');
            statusText.textContent = 'Updating...';

            // Simulate different types of updates
            const updateType = Math.random();

            setTimeout(() => {
                if (updateType < 0.3) {
                    // Update affected people count
                    updateAffectedPeople();
                } else if (updateType < 0.6) {
                    // Update priority level
                    updatePriority();
                } else if (updateType < 0.8) {
                    // Update resource availability
                    updateResources();
                } else {
                    // Add new affected area
                    addNewArea();
                }

                // Reset status
                statusDot.classList.remove('updating');
                statusText.textContent = 'Active';
                lastUpdateTime = new Date();
                updateTimeDisplay();
                newUpdatesCount++;

                // Update the display
                updateCounts();
                populateAreasList();

            }, 1000);
        }

        // Update affected people count in an area
        function updateAffectedPeople() {
            if (affectedAreas.length === 0) return;

            const randomArea = affectedAreas[Math.floor(Math.random() * affectedAreas.length)];
            const change = Math.floor(Math.random() * 100) - 50;
            randomArea.affectedPeople = Math.max(50, randomArea.affectedPeople + change);
            randomArea.lastUpdated = new Date().toLocaleString();

            // Update marker popup
            const marker = markers.affected.find(m => m.areaData.id === randomArea.id);
            if (marker) {
                marker.areaData = randomArea;
                marker.setPopupContent(`
                    <div class="custom-popup">
                        <h3>${randomArea.name}</h3>
                        <p><strong>Priority:</strong> <span style="color: ${getMarkerColor(randomArea.priority)}; text-transform: uppercase;">${randomArea.priority}</span></p>
                        <p><strong>Affected People:</strong> ${randomArea.affectedPeople} <span style="color: #28a745; font-weight: bold;">‚Üª UPDATED</span></p>
                        <p><strong>Resources Needed:</strong> ${randomArea.resources.join(', ')}</p>
                        <p><strong>Description:</strong> ${randomArea.description}</p>
                        <p><strong>Last Updated:</strong> ${randomArea.lastUpdated}</p>
                    </div>
                `);
            }

            console.log(`üìä Updated: ${randomArea.name} - ${randomArea.affectedPeople} people`);
        }

        // Update priority level
        function updatePriority() {
            if (affectedAreas.length === 0) return;

            const randomArea = affectedAreas[Math.floor(Math.random() * affectedAreas.length)];
            const priorities = ['low', 'medium', 'high', 'critical'];
            const currentIndex = priorities.indexOf(randomArea.priority);

            // Change priority (slight chance to escalate or de-escalate)
            const change = Math.random() > 0.5 ? 1 : -1;
            const newIndex = Math.max(0, Math.min(3, currentIndex + change));
            const oldPriority = randomArea.priority;
            randomArea.priority = priorities[newIndex];
            randomArea.lastUpdated = new Date().toLocaleString();

            // Update marker
            const marker = markers.affected.find(m => m.areaData.id === randomArea.id);
            if (marker) {
                const emoji = {
                    critical: '‚ö†Ô∏è',
                    high: '‚ö°',
                    medium: '‚ö†Ô∏è',
                    low: '‚úì'
                }[randomArea.priority];

                marker.setIcon(createCustomIcon(getMarkerColor(randomArea.priority), emoji));
                marker.areaData = randomArea;
                marker.setPopupContent(`
                    <div class="custom-popup">
                        <h3>${randomArea.name}</h3>
                        <p><strong>Priority:</strong> <span style="color: ${getMarkerColor(randomArea.priority)}; text-transform: uppercase;">${randomArea.priority}</span> <span style="color: #ff8042; font-weight: bold;">‚Üª CHANGED</span></p>
                        <p><strong>Affected People:</strong> ${randomArea.affectedPeople}</p>
                        <p><strong>Resources Needed:</strong> ${randomArea.resources.join(', ')}</p>
                        <p><strong>Description:</strong> ${randomArea.description}</p>
                        <p><strong>Last Updated:</strong> ${randomArea.lastUpdated}</p>
                    </div>
                `);
            }

            console.log(`üö® Priority changed: ${randomArea.name} - ${oldPriority} ‚Üí ${randomArea.priority}`);
        }

        // Update resource needs
        function updateResources() {
            if (affectedAreas.length === 0) return;

            const randomArea = affectedAreas[Math.floor(Math.random() * affectedAreas.length)];
            const allResources = ['Medical', 'Food', 'Water', 'Shelter', 'Blankets', 'Clothing'];

            // Add or remove a resource need
            if (Math.random() > 0.5 && randomArea.resources.length < 4) {
                const available = allResources.filter(r => !randomArea.resources.includes(r));
                if (available.length > 0) {
                    randomArea.resources.push(available[Math.floor(Math.random() * available.length)]);
                }
            } else if (randomArea.resources.length > 1) {
                randomArea.resources.splice(Math.floor(Math.random() * randomArea.resources.length), 1);
            }
            randomArea.lastUpdated = new Date().toLocaleString();

            // Update marker
            const marker = markers.affected.find(m => m.areaData.id === randomArea.id);
            if (marker) {
                marker.areaData = randomArea;
                marker.setPopupContent(`
                    <div class="custom-popup">
                        <h3>${randomArea.name}</h3>
                        <p><strong>Priority:</strong> <span style="color: ${getMarkerColor(randomArea.priority)}; text-transform: uppercase;">${randomArea.priority}</span></p>
                        <p><strong>Affected People:</strong> ${randomArea.affectedPeople}</p>
                        <p><strong>Resources Needed:</strong> ${randomArea.resources.join(', ')} <span style="color: #0088FE; font-weight: bold;">‚Üª UPDATED</span></p>
                        <p><strong>Description:</strong> ${randomArea.description}</p>
                        <p><strong>Last Updated:</strong> ${randomArea.lastUpdated}</p>
                    </div>
                `);
            }

            console.log(`üì¶ Resources updated: ${randomArea.name} - ${randomArea.resources.join(', ')}`);
        }

        // Add new affected area
        function addNewArea() {
            const newId = Math.max(...affectedAreas.map(a => a.id)) + 1;
            const priorities = ['low', 'medium', 'high', 'critical'];
            const locations = ['Mymensingh', 'Bogra', 'Jessore', 'Comilla', 'Narayanganj', 'Gazipur', 'Tangail', 'Brahmanbaria'];
            const resourceTypes = [
                ['Medical', 'Food'],
                ['Water', 'Shelter'],
                ['Food', 'Water', 'Blankets'],
                ['Medical', 'Water'],
                ['Shelter', 'Clothing', 'Food']
            ];

            // Random coordinates within Bangladesh bounds
            const baseLat = 23.8103; // Dhaka center
            const baseLng = 90.4125;
            const newLat = baseLat + (Math.random() - 0.5) * 4; // Spread across Bangladesh
            const newLng = baseLng + (Math.random() - 0.5) * 3;

            const newArea = {
                id: newId,
                name: `${locations[Math.floor(Math.random() * locations.length)]} - Emergency ${newId}`,
                priority: priorities[Math.floor(Math.random() * priorities.length)],
                coordinates: [newLat, newLng],
                affectedPeople: Math.floor(Math.random() * 500) + 100,
                resources: resourceTypes[Math.floor(Math.random() * resourceTypes.length)],
                description: 'New emergency situation reported',
                lastUpdated: new Date().toLocaleString()
            };

            affectedAreas.push(newArea);

            // Add marker
            const emoji = {
                critical: '‚ö†Ô∏è',
                high: '‚ö°',
                medium: '‚ö†Ô∏è',
                low: '‚úì'
            }[newArea.priority];

            const icon = createCustomIcon(getMarkerColor(newArea.priority), emoji);
            const marker = L.marker(newArea.coordinates, { icon })
                .addTo(map)
                .bindPopup(`
                    <div class="custom-popup">
                        <h3>${newArea.name}</h3>
                        <p><strong>Priority:</strong> <span style="color: ${getMarkerColor(newArea.priority)}; text-transform: uppercase;">${newArea.priority}</span> <span style="color: #28a745; font-weight: bold;">üÜï NEW</span></p>
                        <p><strong>Affected People:</strong> ${newArea.affectedPeople}</p>
                        <p><strong>Resources Needed:</strong> ${newArea.resources.join(', ')}</p>
                        <p><strong>Description:</strong> ${newArea.description}</p>
                        <p><strong>Last Updated:</strong> ${newArea.lastUpdated}</p>
                    </div>
                `);

            marker.areaData = newArea;
            markers.affected.push(marker);

            // Briefly open popup to show new area
            setTimeout(() => {
                map.setView(newArea.coordinates, 14);
                marker.openPopup();
            }, 500);

            console.log(`üÜï New area added: ${newArea.name} - ${newArea.priority} priority`);
        }

        // Start real-time updates
        function startRealTimeUpdates() {
            // Update every 8-15 seconds
            const getRandomInterval = () => Math.floor(Math.random() * 7000) + 8000;

            const scheduleNextUpdate = () => {
                updateInterval = setTimeout(() => {
                    simulateRealTimeUpdate();
                    scheduleNextUpdate();
                }, getRandomInterval());
            };

            scheduleNextUpdate();

            // Update time display every second
            setInterval(updateTimeDisplay, 1000);
        }

        // Stop real-time updates
        function stopRealTimeUpdates() {
            if (updateInterval) {
                clearTimeout(updateInterval);
                updateInterval = null;
            }
            document.getElementById('statusDot').style.background = '#dc3545';
            document.getElementById('statusText').textContent = 'Paused';
        }

        // Toggle real-time updates
        let updatesActive = true;
        document.getElementById('toggleUpdatesBtn').addEventListener('click', function () {
            updatesActive = !updatesActive;

            if (updatesActive) {
                startRealTimeUpdates();
                this.innerHTML = '‚è∏Ô∏è Pause Updates';
                this.style.background = '#28a745';
                this.style.borderColor = '#28a745';
                console.log('‚úÖ Real-time updates resumed');
            } else {
                stopRealTimeUpdates();
                this.innerHTML = '‚ñ∂Ô∏è Resume Updates';
                this.style.background = '#dc3545';
                this.style.borderColor = '#dc3545';
                console.log('‚è∏Ô∏è Real-time updates paused');
            }
        });

        // Switch Map View Function
        function switchMapView(viewType) {
            // Remove current layer
            if (currentLayer) {
                map.removeLayer(currentLayer);
            }

            // Add new layer
            currentLayer = tileLayers[viewType];
            currentLayer.addTo(map);
            currentViewType = viewType;

            // Update button states
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            const activeBtn = document.getElementById(`${viewType}ViewBtn`);
            if (activeBtn) {
                activeBtn.classList.add('active');
            }

            console.log(`üó∫Ô∏è Switched to ${viewType} view`);

            // Show notification
            const viewNames = {
                standard: 'üìç Standard Map View',
                satellite: 'üõ∞Ô∏è Satellite View',
                hybrid: 'üåç Hybrid View',
                terrain: '‚õ∞Ô∏è Terrain View'
            };

            showViewNotification(viewNames[viewType] || 'Map View Changed');
        }

        // Show view change notification
        function showViewNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                z-index: 10000;
                font-weight: 600;
                animation: slideInRight 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        // Make function global
        window.switchMapView = switchMapView;

        // Initialize
        updateCounts();
        populateAreasList();

        // Set default active button
        document.getElementById('showAllBtn').classList.add('active');

        // Start real-time updates
        startRealTimeUpdates();
        console.log('üî¥ Real-time updates started');
        console.log('üó∫Ô∏è Map initialized with real-time view capabilities');
        console.log('üìç Bangladesh location database loaded:', allBangladeshLocations.length, 'locations');
    </script>
</body>

</html>